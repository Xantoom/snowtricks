{% extends 'layout/base.html.twig' %}

{% block javascripts %}
	{{ importmap('snowtrick-edit') }}
{% endblock %}

{% block title %}Edit {{ snowtrick.name }}{% endblock %}

{% block body %}
	<!-- Banner Section -->
	<div class="banner">
		<img src="{{ snowtrick.firstImage is not null ? asset('uploads/' ~ snowtrick.firstImage.path) : defaultBannerImg }}" alt="Snowboard banner" class="banner-image">
		<div class="banner-overlay"></div>

		<!-- Add centered title like on index page -->
		<div class="position-absolute top-50 start-50 translate-middle text-center text-white">
			<h1 class="banner-text mb-3">{{ snowtrick.name }}</h1>
			<p class="banner-subtext">{{ snowtrick.category.value }}</p>
		</div>

		<!-- Edit banner button -->
		<div class="banner-edit-btn" data-bs-toggle="modal" data-bs-target="#editBannerModal">
			<i class="fas fa-camera"></i>
		</div>

		{% if snowtrick.firstImage is not null %}
			<div class="position-absolute top-0 end-0 p-3">
				<button class="btn btn-danger btn-lg rounded-circle" data-bs-toggle="modal" data-bs-target="#deleteBannerModal" data-file-id="{{ snowtrick.firstImage.id }}">
					<i class="fas fa-trash"></i>
				</button>
			</div>
		{% endif %}
	</div>

	<form id="snowtrickForm" action="{{ path('app_snowtrick_edit', {'slug': snowtrick.slug}) }}" method="post" enctype="multipart/form-data">
		<div class="container mb-5">
			<!-- Media Section -->
			<div class="media-container mb-4">
				<h3 class="mb-3"><i class="fas fa-photo-video me-2"></i>Media Gallery</h3>

				<div class="media-carousel">
					<!-- Add new media card -->
					<div class="media-item add-media-card" data-bs-toggle="modal" data-bs-target="#addMediaModal">
						<div class="text-center">
							<i class="fas fa-plus fa-2x mb-2 text-secondary"></i>
							<p class="mb-0 text-secondary">Add Media</p>
						</div>
					</div>

					<!-- Existing media items -->
					{% for file in snowtrick.files %}
						<div class="media-item">
							{% if file.type == 'image' %}
								<img src="{{ asset('uploads/' ~ file.path) }}" alt="Trick media" class="img-fluid">
								<span class="media-type-badge bg-primary text-white">Image</span>
							{% elseif file.type == 'video' %}
								<div class="ratio ratio-16x9 h-100">
									<iframe src="{{ file.path }}" allowfullscreen></iframe>
								</div>
								<span class="media-type-badge bg-danger text-white">Video</span>
							{% endif %}
							<div class="media-actions">
								<button type="button" class="btn btn-edit-media" data-bs-toggle="modal" data-bs-target="#editMediaModal" data-file-id="{{ file.id }}" data-file-type="{{ file.type }}">
									<i class="fas fa-edit text-success"></i>
								</button>
								<button type="button" class="btn btn-delete-media" data-bs-toggle="modal" data-bs-target="#deleteMediaModal" data-file-id="{{ file.id }}">
									<i class="fas fa-trash text-danger"></i>
								</button>
							</div>
						</div>
					{% endfor %}
				</div>
			</div>

			<!-- Trick Details Section -->
			<div class="card shadow-sm mb-4">
				<div class="card-body">
					<div class="mb-3">
						<label for="trickTitle" class="form-label fw-bold">Title</label>
						<input type="text" class="form-control form-control-lg" id="trickTitle" name="title" value="{{ snowtrick.name }}" required>
					</div>

					<div class="mb-3">
						<label for="trickDescription" class="form-label fw-bold">Description</label>
						<textarea class="form-control" id="trickDescription" name="description" rows="6" required>{{ snowtrick.description }}</textarea>
					</div>

					<div class="mb-3">
						<label for="trickCategory" class="form-label fw-bold">Category</label>
						<select class="form-select" id="trickCategory" name="category" required>
							{% for category in categories %}
								<option value="{{ category.value }}" {% if category == snowtrick.category %}selected{% endif %}>
									{{ category.value }}
								</option>
							{% endfor %}
						</select>
					</div>
				</div>
			</div>

			<!-- Action Buttons -->
			<div class="d-flex justify-content-between">
				<button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteTrickModal">
					<i class="fas fa-trash me-2"></i>Delete Trick
				</button>
				<button type="submit" class="btn btn-primary">
					<i class="fas fa-save me-2"></i>Save Changes
				</button>
			</div>
		</div>
	</form>

	<!-- Add Media Modal -->
	<div class="modal fade" id="addMediaModal" tabindex="-1" aria-labelledby="addMediaModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="addMediaModalLabel">Add New Media</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<form id="addMediaForm" action="{{ path('app_snowtrick_add_media', {'slug': snowtrick.slug}) }}" method="post" enctype="multipart/form-data">
					<div class="modal-body">
						<div class="mb-3">
							<label for="mediaType" class="form-label">Media Type</label>
							<select class="form-select" id="mediaType" name="mediaType">
								<option value="image">Image</option>
								<option value="video">Video</option>
							</select>
						</div>

						<div id="imageUploadForm">
							<div class="mb-3">
								<label for="imageFile" class="form-label">Upload Image</label>
								<input class="form-control" type="file" id="imageFile" name="imageFile" accept="image/*">
							</div>
						</div>

						<div id="videoUrlForm" style="display: none;">
							<div class="mb-3">
								<label for="videoUrl" class="form-label">Video URL (YouTube, Vimeo, etc.)</label>
								<input type="url" class="form-control" id="videoUrl" name="videoUrl" placeholder="https://www.youtube.com/embed/...">
								<small class="text-muted">Use embed links for better compatibility</small>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Add Media</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Edit Media Modal -->
	<div class="modal fade" id="editMediaModal" tabindex="-1" aria-labelledby="editMediaModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="editMediaModalLabel">Edit Media</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<form id="editMediaForm" action="{{ path('app_snowtrick_edit_media', {'slug': snowtrick.slug}) }}" method="post" enctype="multipart/form-data">
					<div class="modal-body">
						<input type="hidden" id="editFileId" name="fileId">
						<div id="editImageForm">
							<div class="mb-3">
								<label for="editImageFile" class="form-label">Replace Image</label>
								<input class="form-control" type="file" id="editImageFile" name="imageFile" accept="image/*">
							</div>
						</div>
						<div id="editVideoForm" style="display: none;">
							<div class="mb-3">
								<label for="editVideoUrl" class="form-label">Video URL</label>
								<input type="url" class="form-control" id="editVideoUrl" name="videoUrl" placeholder="https://www.youtube.com/embed/...">
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<button type="submit" class="btn btn-primary">Save Changes</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- Delete Media Modal -->
	<div class="modal fade" id="deleteMediaModal" tabindex="-1" aria-labelledby="deleteMediaModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteMediaModalLabel">Delete Media</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete this media file? This action cannot be undone.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-danger" id="confirmDeleteMedia">Delete</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Delete Banner Modal -->
	<div class="modal fade" id="deleteBannerModal" tabindex="-1" aria-labelledby="deleteBannerModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteBannerModalLabel">Delete Banner Image</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete the banner image? The default banner will be displayed instead.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-danger" id="confirmDeleteBanner">Delete</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Delete Trick Modal -->
	<div class="modal fade" id="deleteTrickModal" tabindex="-1" aria-labelledby="deleteTrickModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="deleteTrickModalLabel">Delete Trick</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<p>Are you sure you want to delete <strong>{{ snowtrick.name }}</strong>? This will permanently remove all associated media and comments.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-danger" id="confirmDeleteTrick" data-trick-id="{{ snowtrick.id }}">Delete</button>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
